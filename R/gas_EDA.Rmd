---
title: "Gas Forecasting Exploratory Data Analysis"
author: "Brian Seko"
date: "2023-09-27"
output: html_document
params:
  db_file: "/database/gas_data.db"
---

```{r setup, include=FALSE}
library(DBI)
library(RSQLite)
library(tidyverse)
library(here)
library(lubridate)
library(ggplot2)
library(TSstudio)
library(plotly)

knitr::opts_chunk$set(echo = FALSE, fig.show='asis')
```

```{r, connect to gas forecasting database}
con <- dbConnect(RSQLite::SQLite(), paste0(here(),params$db_file))
gas_raw <- dbGetQuery(con, "select * from gas_prices")
```

# Simple Trend Analysis

We'll start with a very simple trend analysis. Let's take the average price by month and plot it since 1993.

```{r, Describe Average by Month}
gas_monthly_average <- gas_raw %>% 
  mutate(year = year(period), month=month(period), period_month=as.Date(paste0(year,"-", month, "-01"))) %>% 
  group_by(period_month, padd) %>% 
  summarise(monthly_average = round(mean(price),2), .groups = "drop") %>% 
  mutate(
    padd_descrip = case_when(
      padd=="PADD 1" ~"East Coast",
      padd=="PADD 2" ~"Midwest", 
      padd=="PADD 3" ~"Gulf Coast",
      padd=="PADD 4" ~"Rocky Mountain",
      TRUE ~"West Coast"),
  ) %>% select(-padd)

gas_national_average <- gas_raw %>% 
  mutate(year = year(period), month=month(period), period_month=as.Date(paste0(year,"-", month, "-01"))) %>% 
  group_by(period_month) %>% 
  summarise(monthly_average = round(mean(price),2), .groups = "drop") %>% 
  mutate(padd_descrip="National")

gas_monthly_average_w_national <- rbind(gas_monthly_average,gas_national_average)
```

```{r, fig.width=13, fig.height=6}
gas_over_time_plot <- ggplot(data = gas_monthly_average_w_national, aes(x = period_month, y=monthly_average))+
  geom_line(aes(color = padd_descrip))+
  theme_minimal()+
  scale_x_date(date_breaks = "5 years", date_labels="%Y")+
  scale_y_continuous(breaks = seq(0,ceiling(max(gas_monthly_average_w_national$monthly_average)), by = 1),
                     limits = c(0, NA)) +
  labs(y="Dollars", x="", color = "Region", title="Average Gas Price per Month")

ggplotly(gas_over_time_plot, width = 1000, height = 500)
```


## Observations














